<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>PHP5.5.X连接MS SQL SEVER | 还是码农的缠小溪</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="准备工作1. 安装Microsoft SQL Server 2012 Native Client这个是必须要安装的，微软给出了如下说明

The x86 version of SQL Server Native Client is required on the computer where PHP is running. If you are using a 64-bit operating s">
<meta property="og:type" content="article">
<meta property="og:title" content="PHP5.5.X连接MS SQL SEVER">
<meta property="og:url" content="http://chanxiaoxi.github.io/2014/05/05/new/index.html">
<meta property="og:site_name" content="还是码农的缠小溪">
<meta property="og:description" content="准备工作1. 安装Microsoft SQL Server 2012 Native Client这个是必须要安装的，微软给出了如下说明

The x86 version of SQL Server Native Client is required on the computer where PHP is running. If you are using a 64-bit operating s">
<meta property="og:updated_time" content="2015-04-20T16:23:36.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="PHP5.5.X连接MS SQL SEVER">
<meta name="twitter:description" content="准备工作1. 安装Microsoft SQL Server 2012 Native Client这个是必须要安装的，微软给出了如下说明

The x86 version of SQL Server Native Client is required on the computer where PHP is running. If you are using a 64-bit operating s">
  
    <link rel="alternative" href="/atom.xml" title="还是码农的缠小溪" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  <link rel="stylesheet" href="/css/style.css" type="text/css">
  

</head>
<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">还是码农的缠小溪</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">不懂生活的码农不是好的programer</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://chanxiaoxi.github.io"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="post-new" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2014/05/05/new/" class="article-date">
  <time datetime="2014-05-05T00:40:27.000Z" itemprop="datePublished">2014-05-05</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/PHP/">PHP</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      PHP5.5.X连接MS SQL SEVER
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h4 id="准备工作">准备工作</h4><h5 id="1-_安装Microsoft_SQL_Server_2012_Native_Client">1. 安装Microsoft SQL Server 2012 Native Client</h5><p>这个是必须要安装的，微软给出了如下说明</p>
<blockquote>
<p>The x86 version of SQL Server Native Client is required on the computer where PHP is running. If you are using a 64-bit operating system, the x86 version of SQL Server Native Client will be installed with the x64 version of SQL Server Native Client (do not install the x86 version of SQL Server Native Client on an x64 operating system).</p>
</blockquote>
<p>可能你会对MS提供的下载包产生迷惑，选择相应版本的sqlncli.msi下载就可以了，这是Microsoft SQL Server 2008的客户端下载连接<a href="http://www.microsoft.com/en-us/download/details.aspx?id=27596" target="_blank" rel="external">Microsoft SQL Server 2008 Service Pack 3 Feature Pack</a><a id="more"></a></p>
<h5 id="2-_安装Microsoft_Drivers_for_PHP_for_SQL_Server">2. 安装Microsoft Drivers for PHP for SQL Server</h5><p>这里有version 2.0和version3.0两个版本可供下载，<a href="http://technet.microsoft.com/en-us/library/cc296170(v=sql.105).aspx" target="_blank" rel="external">这里</a>有详细的说明，不在赘述，官方并没有提供5.5以后版本的driver，如果你的PHP版本是5.5以后的，请参照遇到的问题的解决办法。下载之后将驱动安装在PHP的相应扩展目录下，并配置php.ini文件</p>
<h5 id="3-配置PHP">3.配置PHP</h5><p>我们需要再php.ini文件中添加如下内容：</p>
<pre><code>[PHP_PDO_SQLSRV]
extension=php_pdo_sqlsrv_55_ts<span class="class">.dll</span> <span class="comment">//PHP DAO 扩展</span>
[PHP_SQLSRV]
extension=php_sqlsrv_55_ts<span class="class">.dll</span> <span class="comment">//sqlsrv扩展</span>
</code></pre><h4 id="遇到的问题">遇到的问题</h4><h5 id="1-_PHP_5-5-X没有官方的驱动dll">1. PHP 5.5.X没有官方的驱动dll</h5><p>官方并没有提供PHP 5.5.X的驱动dll，但是有第三方的可以选择，如果你不想改变你的PHP环境，那么就下载第三方的dll来使用 <a href="http://www.hmelihkara.com/files/php_sqlsrv_55.rar" target="_blank" rel="external">下载地址</a></p>
<h5 id="2-_MSVCP110-dll_Missing">2. MSVCP110.dll Missing<br></h5><p>在准备过程中我还遇到了MSVCP110.dll缺失的问题，stackoverflow给出了相关的解决方法<a href="http://stackoverflow.com/questions/21622116/could-not-find-driver-using-sqlsrv-for-pdo" target="_blank" rel="external">“could not find driver” using sqlsrv for PDO</a></p>
<blockquote>
<p>The issue was that I didn’t have the Visual C++ Redistributable package. I realized this after rebooting the computer and getting a MSVCP110.dll missing error in a system dialog box rather than a dialog box from XAMPP.</p>
<p>If anyone else is having this very same issue, download Visual C++ Redistributable for Visual Studio 2012 Update 4 here, in the Microsoft website. Although the computer works with a x64 architecture, I downloaded the x86 version and it worked. Make your choice but I’d recommend doing the same, because PHP is x86 only (x64 is merely experimental and the drivers are x86 aswell).</p>
</blockquote>
<p>安装了Redistributable发现还是不行，原来是没有仔细看人家的方法，虽然是计算机的版本是64位的，XAMPP，所以应该安装32位的Redistributable,安装了32位的之后，it works</p>
<h4 id="PHP_MS_SQL_Server操作">PHP MS SQL Server操作</h4><p>PHP有针对MS SQL Server的扩展函数供我们使用，具体的使用方式参照<a href="http://www.php.net/manual/zh/book.mssql.php" target="_blank" rel="external">PHP文档</a>，当然你也可以使用PHP的<a href="http://cn2.php.net/manual/zh/ref.pdo-sqlsrv.php" target="_blank" rel="external">PDO</a>扩展来操作MS SQL Server</p>
<h4 id="测试连接">测试连接</h4><p>完成配置后就可以测试连接啦，这里使用PHP提供的sqlsrv扩展函数来测试</p>
<pre><code>&lt;?php
    <span class="variable">$serverName</span> = <span class="string">"serverName\sqlexpress"</span>; //serverName\instanceName
    <span class="variable">$connectionOptions</span> = <span class="keyword">array</span>(<span class="string">"Database"</span> =&gt; <span class="string">"Database"</span>, <span class="string">"UID"</span> =&gt; <span class="string">"UID"</span> , <span class="string">"PWD"</span> =&gt; <span class="string">"PWD"</span>);
    <span class="variable">$conn</span> = sqlsrv_connect(<span class="variable">$serverName</span>, <span class="variable">$connectionOptions</span>);
    <span class="keyword">if</span>(<span class="variable">$conn</span>){
        echo <span class="string">"connection established.&lt;br&gt;"</span>;
    }<span class="keyword">else</span>{
        echo <span class="string">"connection could not be established.&lt;br&gt;"</span>;
        die(print_r(sqlsrv_errors(), true));
    }
?&gt;
</code></pre><p>使用PHP PDO扩展测试连接</p>
<pre><code><span class="keyword">try</span>{
    <span class="variable">$pdo</span> = new PDO(<span class="string">'sqlsrv:Server=210.28.32.161;Database=teacher'</span>,<span class="string">"xscpjk1"</span>,<span class="string">"xscpjk1"</span>);
    <span class="variable">$sql</span> = <span class="string">"SELECT * FROM XSCPJK_XSXK WHERE XH='111003131'"</span>;
    foreach(<span class="variable">$pdo-</span>&gt;query(<span class="variable">$sql</span>) as <span class="variable">$row</span>){
        print_r(<span class="variable">$row</span>);
    }
    <span class="variable">$pdo</span> = null; //close connect
}<span class="keyword">catch</span>(PDOException <span class="variable">$e</span>){
    print <span class="string">"Error!:"</span>.<span class="variable">$e-</span>&gt;getMessage().<span class="string">"&lt;br&gt;"</span>;
    die();
}
</code></pre>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://chanxiaoxi.github.io/2014/05/05/new/" data-id="cigyokhd00011yz0rr4c1xd6l" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2014/05/07/php-output-cache-control/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          PHP输出缓冲控制ob_start()及其多级缓冲
        
      </div>
    </a>
  
  
    <a href="/2014/04/28/create-octopress/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">搭建属于自己的octopress技术博客</div>
    </a>
  
</nav>

  
</article>

</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Docker/">Docker</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Linux/">Linux</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/PHP/">PHP</a><span class="category-list-count">7</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Sourcetree/">Sourcetree</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/octopress/">octopress</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/php/">php</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/架构/">架构</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/设计模式/">设计模式</a><span class="category-list-count">1</span></li></ul>
    </div>
  </div>

  
    
  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/05/">May 2015</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/04/">April 2015</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/12/">December 2014</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/11/">November 2014</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/05/">May 2014</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/04/">April 2014</a><span class="archive-list-count">1</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recents</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2015/05/17/hi-docker/">Docker学习笔记(一)——认识Docker</a>
          </li>
        
          <li>
            <a href="/2015/04/20/linux-crontab/">Linux Crontab</a>
          </li>
        
          <li>
            <a href="/2014/12/07/lambda-anonymous-function-and-closure/">Lambda, Anonymous Function And Closure</a>
          </li>
        
          <li>
            <a href="/2014/12/06/php-code-style-guide-psr0/">PHP Code Style Guide---PSR0</a>
          </li>
        
          <li>
            <a href="/2014/12/01/sourcetree-lf-slash-crlf-auto-change-on-windows/">Sourcetree LF/CRLF auto change on Windows</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2015 Gavin Wu<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css" type="text/css">
  <script src="/fancybox/jquery.fancybox.pack.js" type="text/javascript"></script>


<script src="/js/script.js" type="text/javascript"></script>

  </div>
</body>
</html>